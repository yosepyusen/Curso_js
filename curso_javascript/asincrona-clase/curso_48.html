<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>asincronia en js</h1>
    <script>//await * async
        //las funciones SINCRONAS no vienen a reemplazar a PROMESAS en anterior clase sino mas bien trabajan juntos en armonia
        //LOADER: lo que permite a que no puede darle a interactuar con una pagina web, hasta que carga completamente la pagina con sus productos
        function cuadradoPromise(value){//cuadradoPromise, devuelve un objeto por eso: obj
         if (typeof value!=="number") {
             return Promise.reject(`Error el valor ingresado "${value}" no es un numero`);
         }
         return new Promise((resolve, reject)=>{              
          setTimeout(()=>{
           resolve({
            value: value,//aqui podemos solo poner:: " value, "
            result: value*value
            });
           }, 0 | Math.random()*1000);
         });
        }
        //para usar AWAIT se debe usar una function ASINCRONA
        // si utilizas async antes de function, es un forma de decirle que es una function asincrona en js
        //entonces debemos utilizar palabra reservada :: await ::
        async function funcionAsyncronaDeclarada(){//no se va ejecutar asta q le llamamos, por eso es function declarada
         try{
            console.log("Inicio async function");
            let obj = await cuadradoPromise(0);//dice esta linea de cod: vas esperar el resultado de esta ejecucion antes de pasar al siguiente linea y ejecutarla, y que no salga UNDEFINED
            //el await se usa porque la function cuadradoPromise(), todavia no me devuelve ese objeto, es decir al instante no devuelve sino sale UNDEFINED, UNDEFINED
            //cuando declaras una funcion como asincrona:ASYNC, entonces debes utilizar una palabra reservada que se llama AWAIT:espera
            //de cuadradopromise(), la optimizacion a nivel de sintaxis es que al trabajar con funciones asincronas cada peticion lo puedo guardar en una variable
            //y evitar el uso de THEN indiscriminados, llamado como infierno de las promesas
            
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            //mas que todo el AWAIT se usa para evitar el uso de muchos THEN, cuando tu cod. es desordenado y equivocarte con con las llaves de este then
            obj = await cuadradoPromise(1);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            obj = await cuadradoPromise(2);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
           
            obj = await cuadradoPromise(3);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            obj = await cuadradoPromise(4);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            obj = await cuadradoPromise(5);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            console.log("Fin Async Function");
        }catch (err){//al capturar el error inmediatamente se termina el cod y sale error
            console.error(err);
         }
        }

        funcionAsyncronaDeclarada(); //aqui llamamos la funcion declarada
        
        
        const funcionAsincronaExpresada = async ()=>{//para que sea ASINCRONA se debe piner antes del () la palabra  ASYNC
            try{
            console.log("Inicio async function OTRA FORMA");
            
            let obj = await cuadradoPromise(6);//espera el resultado de cuadradopromise()
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            obj = await cuadradoPromise(7);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            obj = await cuadradoPromise(8);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
           
            obj = await cuadradoPromise(9);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            obj = await cuadradoPromise(10);
            console.log(`Async function: ${obj.value}, ${obj.result} `);
            
            console.log("Fin Async Function");
        }catch (err){
            console.error(err);
         }
        }

        funcionAsincronaExpresada(); //aqui llamamos a una function expresada
        //SI LAS FUNCIONES SE EJECUTAN AL MISMO TIEMPO, imprime en forma aleatorio mezclando
        //CURSO 49 empieza con js_con_html, ene el file: nuevo-tipo.html
    </script>
</body>
</html>